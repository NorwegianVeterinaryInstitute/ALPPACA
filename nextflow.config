// Singularity image paths for each process
singularity_img_dir="file:///cluster/projects/nn9305k/nextflow/alppaca_images"

process {
	withName: PARSNP {
		container = "${singularity_img_dir}/parsnp:1.6.1--h9a82719_0"
	}
	withName: SNIPPY {
		container = "${singularity_img_dir}/snippy:4.6.0--hdfd78af_1"
	}
        withName: PANAROO_PANGENOME {
                container = "${singularity_img_dir}/panaroo:1.2.9--pyhdfd78af_0"
        }
	withName: PANAROO_QC {
		container = "${singularity_img_dir}/panaroo:1.2.9--pyhdfd78af_0"
	}
	withName: IQTREE {
		container = "${singularity_img_dir}/iqtree:2.1.4_beta--hdcc8f71_0"
	}
        withName: IQTREE_FCONST {
                container = "${singularity_img_dir}/iqtree:2.1.4_beta--hdcc8f71_0"
        }
	withName: GUBBINS {
		container = "${singularity_img_dir}/gubbins:3.1.3--py38h390ddb8_0"
	}
	withName: MASKRC {
		container = "${singularity_img_dir}/maskrc-svg:0.5--1"
	}
	withName: PROKKA {
		container = "${singularity_img_dir}/prokka:1.14.6--pl5262hdfd78af_1"
	}
	withName: DEDUPLICATE {
		container = "${singularity_img_dir}/seqkit:2.1.0--h9ee0642_0"
	}
	withName: SNPDIST {
		container = "${singularity_img_dir}/snp-dists:0.8.2--h5bf99c6_0"
	}
	withName: SNPSITES {
		container = "${singularity_img_dir}/snp-sites:2.5.1--h5bf99c6_1"
	}
        withName: SNPSITES_FCONST {
                container = "${singularity_img_dir}/snp-sites:2.5.1--h5bf99c6_1"
        }
        withName: REPORT_CORE_GENOME_DEDUP {
                container = "${singularity_img_dir}/r_base_4.1.2_alppaca:latest"
        }
        withName: REPORT_CORE_GENE_DEDUP {
                container = "${singularity_img_dir}/r_base_4.1.2_alppaca:latest"
        }
        withName: REPORT_MAPPING_DEDUP {
                container = "${singularity_img_dir}/r_base_4.1.2_alppaca:latest"
        }
	withName: REPORT_CORE_GENOME {
		container = "${singularity_img_dir}/r_base_4.1.2_alppaca:latest"
	}
        withName: REPORT_CORE_GENE {
                container = "${singularity_img_dir}/r_base_4.1.2_alppaca:latest"
        }
        withName: REPORT_MAPPING {
                container = "${singularity_img_dir}/r_base_4.1.2_alppaca:latest"
        }
}

// Singularity options
profiles {
	singularity {
        	singularity.enabled	= true
		singularity.runOptions	= "--bind /cluster"
	}
}

// SLURM options
process {
	executor = 'slurm'
	clusterOptions = '--job-name=ALPPACA --account=nn9305k --mem-per-cpu=4700M'
	queueSize = 24
	maxRetries = 2
	errorStrategy='retry'
	time = {8.h * task.attempt}
	cpus = 4

	withLabel: medium {
		cpus = 8
	}

	withLabel: heavy {
		cpus = 20
	}

	withLabel: bigmem {
		cpus = 8
		clusterOptions = '--job-name=ALPPACA --account=nn9305k --partition=bigmem --mem-per-cpu=32000M'
	}

	withLabel: bigmem_gubbins {
		time = { 48.h * task.attempt }
                cpus = 8
                clusterOptions = '--job-name=ALPPACA --account=nn9305k --partition=bigmem --mem-per-cpu=32000M'
        }
	
	withLabel: shorttime {
		time = { 1.h * task.attempt }
		cpus = 1
	}

	withLabel: longtime {
		time = { 48.h * task.attempt }
		cpus = 8
	}
}

params.module_dir	= "../modules"
params.workflow_dir	= "./workflows"
